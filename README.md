# saebr-instance

A quick-start project with the files necessary for an installation of 
[saebr](https://github.com/DrJosh9000/saebr).

## Setup

1.  Install the Google Cloud SDK.
2.  Create GCP project and and enable App Engine.
3.  Create a Google Sign-in credential (Web client) and make a note of the 
    Client ID .
4.  `git clone` this repo (or otherwise put all the files in a directory 
    somewhere). Rename it, etc. 
5.  Edit `app.yaml`
    *   In particular, after it says `DATASTORE_PROJECT_ID:`, put your GCP 
        project ID.
6.  Edit `page.html`, `favicon.ico`, `robots.txt` to suit your needs.
7.  `gcloud app deploy`
8.  `gcloud datastore indexes create index.yaml`
9.  Browse to your App Engine site. It might return a 404 error.
10. Browse to 
    [GCP Cloud Datastore](https://console.cloud.google.com/datastore/entities) 
    and edit the `Site` entity that the app created automatically. 
    Fill in the empty fields. The fields are explained in the next section.
11. Try the site again - hopefully it works this time!

## Configuration

Most configuration is done via the `Site` entity. You can configure multiple
`Site` entities and switch between them using the arg to `saebr.Run` in 
`app.go`.

| `Site` field        | Meaning                                                              |
| ------------------- | -------------------------------------------------------------------- |
| `AdminEmail`        | A Google account that is permitted to edit content.                  |
| `FeedCopyright`     | Used as the copyright line in feeds (RSS, etc)                       |
| `FeedDescription`   | Description of the content for feeds (RSS, etc)                      |
| `FeedSubtitle`      | Subtitle (for feeds)                                                 |
| `FeedTitle`         | Title (for feeds)                                                    |
| `PageTemplate`      | Name of the file to use as template.                                 |
| `Secret`            | Used to validate login cookies and XSRF tokens (generated by setup). |
| `TimeLocation`      | What time location to use to format times.                           |
| `URLBase`           | The base URL (e.g. for computing absolute URLs for RSS feeds).       |
| `WebSignInClientID` | Client ID used for Google Sign-In.                                   |

## Usage

To create a page (e.g. at `/somepage`), just browse to `/edit/somepage`. 

- If you are not logged in you'll be redirected through `/login`.
- The account you log in with should match `AdminEmail` in the `Site` entity.

You can also manually craft `Page` entities (as child entities of the 
corresponding `Site`), if you dare.

 | `Page` field | Meaning                                                                                |
 | ------------ | -------------------------------------------------------------------------------------- |
 | `Key`        | URL path of the page (minus the leading slash).                                        |
 | `Title`      | Page title.                                                                            |
 | `Published`  | Makes the page publicly accessible.                                                    |
 | `Blog`       | Makes the page appear in `/index`, and also on `/` if the most recently created.       |
 | `Category`   | A string to use as category. (NB: category indexes and feeds are not yet implemented). |
 | `Tags`       | A set of strings to use as tags. (NB: tag indexes and feeds are not yet implemented).  |
 | `Contents`   | Markdown-formatted content to display.                                                 |

In order to preview a page you must first save it. However, it doesn't need to be
Published in order to preview it.

### Uploading images, static content, etc

This is a DIY affair. Consider using one of the GCS buckets that come with App
Engine. Then link to them with standard Markdown.
